<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Interface</title>
    <script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>
    <style>
        /* CSS styles from previous code */
    </style>
</head>
<body>
    <div class="main-container">
        <div class="contacts">
            <div class="add-contact">
                <input type="text" placeholder="Add new contact" id="contact-input">
                <button id="add-contact-btn">Add</button>
            </div>
            <h2>Contacts</h2>
            <ul id="contacts-list"></ul>
            <div class="group-container">
                <h3>Create Group</h3>
                <input type="text" placeholder="Group name" id="group-name-input">
                <ul id="group-contacts-list"></ul>
                <button id="create-group-btn" class="create-group-button">Create Group</button>
            </div>
        </div>
        <div class="chat-container">
            <div class="profile">
                <img src="https://via.placeholder.com/40" alt="Profile Picture">
                <span id="profile-name">Username</span>
            </div>
            <div class="chat-messages" id="chat-messages"></div>
            <div class="message-input">
                <input type="text" placeholder="Type a message" id="message-input">
                <button id="send-message-btn">Send</button>
            </div>
        </div>
    </div>

    <script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>
    <script>
        // Pusher configuration
        const pusher = new Pusher('40cef23173baad97896a', {
            cluster: 'mt1',
            encrypted: true
        });

        const channel = pusher.subscribe('my-channel');

        // Function to handle incoming messages
        channel.bind('my-event', function(data) {
            const chatMessages = document.getElementById('chat-messages');
            const p = document.createElement('p');
            p.textContent = `${data.username}: ${data.message}`;
            chatMessages.appendChild(p);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom
        });

        // Prompt for username on page load
        let username = prompt('Enter your username:');
        while (!username) {
            username = prompt('Enter a valid username:');
        }
        document.getElementById('profile-name').textContent = username;

        // Function to send messages
        document.getElementById('send-message-btn').addEventListener('click', () => {
            const messageInput = document.getElementById('message-input');
            const messageText = messageInput.value.trim();
            if (messageText) {
                fetch('https://YOUR_SERVER_URL/pusher/trigger', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: messageText,
                        username: username
                    })
                });
                messageInput.value = '';
            }
        });

        // Function to add contacts
        document.getElementById('add-contact-btn').addEventListener('click', () => {
            const contactInput = document.getElementById('contact-input');
            const contactName = contactInput.value.trim();
            if (contactName) {
                // Check if the contact is available (dummy check)
                const contactsList = document.getElementById('contacts-list');
                const contactExists = Array.from(contactsList.children)
                                        .some(li => li.textContent.includes(contactName));

                if (!contactExists) {
                    const li = document.createElement('li');
                    li.textContent = contactName;
                    li.classList.add('contact-item');
                    contactsList.appendChild(li);
                } else {
                    alert('Contact already exists!');
                }
                contactInput.value = '';
            }
        });

        // Function to create groups
        document.getElementById('create-group-btn').addEventListener('click', () => {
            const groupNameInput = document.getElementById('group-name-input');
            const groupName = groupNameInput.value.trim();
            const selectedContacts = document.querySelectorAll('.contact-item.selected');

            if (groupName && selectedContacts.length > 0) {
                const groupContacts = Array.from(selectedContacts).map(contact => contact.textContent);

                // Dummy logic: create group here
                const groupContactsList = document.getElementById('group-contacts-list');
                const groupLi = document.createElement('li');
                groupLi.textContent = groupName;
                groupLi.classList.add('group-item');
                groupContactsList.appendChild(groupLi);

                selectedContacts.forEach(contact => contact.classList.remove('selected'));
                groupNameInput.value = '';
            } else {
                alert('Please enter a group name and select contacts.');
            }
        });

        // Event listener for clicking contacts
        document.getElementById('contacts-list').addEventListener('click', (event) => {
            const target = event.target;
            if (target.matches('.contact-item')) {
                target.classList.toggle('selected');
            }
        });
    </script>
</body>
</html>
